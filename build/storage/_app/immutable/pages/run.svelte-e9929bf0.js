import{S as D,i as J,s as R,e as _,t as C,k,c as v,a as b,h as T,d,m as x,b as y,g as h,J as A,E as P,N as U,v as z,O as F}from"../chunks/index-3b1e7adb.js";import{w as H,b as L}from"../chunks/paths-58176f9b.js";import{s as M,p as V}from"../chunks/prefs-ed3737a1.js";const g=H(""),j=async(c,r,f)=>{console.log("loading prep");const m=fetch("vpython.zip").then(o=>o.arrayBuffer());console.log(r,c);let n;try{n=await loadPyodide({indexURL:f,stdout:c||null,stderr:r||null})}catch(o){throw console.log(o),o}if(n){const o=await m;console.log("Unpacking package"),n.unpackArchive(o,"zip"),console.log("Importing vpython package")}return n},q=async()=>{let c,r;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},c=window.canvas,r=c(),r};function B(c){let r,f,m,n,o,p,u,a,w,i;return{c(){r=_("a"),f=C("Edit this code"),m=k(),n=_("h2"),o=C("Running...."),p=k(),u=_("div"),a=k(),w=_("div"),i=_("textarea"),this.h()},l(t){r=v(t,"A",{href:!0,target:!0});var l=b(r);f=T(l,"Edit this code"),l.forEach(d),m=x(t),n=v(t,"H2",{});var E=b(n);o=T(E,"Running...."),E.forEach(d),p=x(t),u=v(t,"DIV",{id:!0,class:!0}),b(u).forEach(d),a=x(t),w=v(t,"DIV",{});var S=b(w);i=v(S,"TEXTAREA",{rows:!0,cols:!0}),b(i).forEach(d),S.forEach(d),this.h()},h(){y(r,"href",L+"/"),y(r,"target","_self"),y(u,"id","glowscript"),y(u,"class","glowscript"),y(i,"rows","10"),y(i,"cols","80"),i.hidden=!0},m(t,l){h(t,r,l),A(r,f),h(t,m,l),h(t,n,l),A(n,o),h(t,p,l),h(t,u,l),h(t,a,l),h(t,w,l),A(w,i),c[1](i)},p:P,i:P,o:P,d(t){t&&d(r),t&&d(m),t&&d(n),t&&d(p),t&&d(u),t&&d(a),t&&d(w),c[1](null)}}}let G="https://cdn.jsdelivr.net/pyodide/v0.21.0a3/full/";function O(c,r,f){let m;U(c,V,e=>f(6,m=e));function n(e){i&&g.update(s=>s+=e+`
`)}function o(e){i&&g.update(s=>s+="stderr:"+e+`
`)}let p=null,u,a,w,i=!1,t=m.add_default_imports,l=`from math import *
from numpy import arange
from random import random
from vpython import *
`;z(async()=>{try{w=await q(),p=await j(n,o,G)}catch(e){o(JSON.stringify(e))}if(p)return window.scene=w,window.__reportScriptError=e=>{try{o("__reportScriptError:"+JSON.stringify(e))}catch{o("__reportScriptError: Not sure! Cannot stringify")}debugger},g.set(""),i=!0,E(),()=>{i=!1};o("Pyodide not found")}),M.subscribe(e=>{u=e}),g.subscribe(e=>{a&&(e.length>0&&a.hasAttribute("hidden")&&a.removeAttribute("hidden"),f(0,a.value=e,a),f(0,a.scrollTop=a.scrollHeight,a))});async function E(){try{if(p){let s=u.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");if(s=s.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),s=s.replace(/scene\.waitfor[\ ]*\(/g,"await scene.waitfor("),t){await p.loadPackagesFromImports(l);var e=await p.runPythonAsync(l)}s.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await p.loadPackagesFromImports(s);var e=await p.runPythonAsync(s);e&&g.update(N=>N+=e)}}catch(s){console.log("Error:"+s),g.update(I=>I+="Error:"+s+`
`)}}function S(e){F[e?"unshift":"push"](()=>{a=e,f(0,a)})}return[a,S]}class W extends D{constructor(r){super(),J(this,r,O,B,R,{})}}export{W as default};
