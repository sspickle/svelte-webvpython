import{S as P,i as I,s as T,e as g,t as A,k as b,c as _,a as y,h as S,d as n,m as k,b as h,g as f,J as R,E as x,v as O,L as z}from"../chunks/index-26a557cf.js";import{w as C,b as D}from"../chunks/paths-e19757bb.js";import{s as H}from"../chunks/codeSrc-adb860ce.js";const v=C(""),J=async s=>{console.log("loading prep");const a=fetch("vpython.zip").then(r=>r.arrayBuffer());let i=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/dev/full/",stdout:s||null,stderr:s||null});const u=await a;return console.log("Unpacking package"),i.unpackArchive(u,"zip"),console.log("Importing vpython package"),i},L=async()=>{let s,a;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},s=window.canvas,a=s(),a};function M(s){let a,i,u,r,w,o,l,d,p,c;return{c(){a=g("a"),i=A("Edit this code"),u=b(),r=g("h2"),w=A("Running...."),o=b(),l=g("div"),d=b(),p=g("div"),c=g("textarea"),this.h()},l(t){a=_(t,"A",{href:!0,target:!0});var e=y(a);i=S(e,"Edit this code"),e.forEach(n),u=k(t),r=_(t,"H2",{});var m=y(r);w=S(m,"Running...."),m.forEach(n),o=k(t),l=_(t,"DIV",{id:!0,class:!0}),y(l).forEach(n),d=k(t),p=_(t,"DIV",{});var E=y(p);c=_(E,"TEXTAREA",{rows:!0,cols:!0}),y(c).forEach(n),E.forEach(n),this.h()},h(){h(a,"href",D+"/"),h(a,"target","_self"),h(l,"id","glowscript"),h(l,"class","glowscript"),h(c,"rows","10"),h(c,"cols","80"),c.hidden=!0},m(t,e){f(t,a,e),R(a,i),f(t,u,e),f(t,r,e),R(r,w),f(t,o,e),f(t,l,e),f(t,d,e),f(t,p,e),R(p,c),s[1](c)},p:x,i:x,o:x,d(t){t&&n(a),t&&n(u),t&&n(r),t&&n(o),t&&n(l),t&&n(d),t&&n(p),s[1](null)}}}function U(s,a,i){function u(t){d&&v.update(e=>e+=t+`
`)}let r=null,w,o,l,d=!1;O(async()=>(l=await L(),r=await J(u),window.scene=l,window.__reportScriptError=t=>{u("REPORT ERROR:"+JSON.stringify(t))},v.set(""),d=!0,p(),()=>{d=!1})),H.subscribe(t=>{w=t}),v.subscribe(t=>{o&&(t.length>0&&(console.log("in stdout update:",t),o.removeAttribute("hidden")),i(0,o.value=t,o),i(0,o.scrollTop=o.scrollHeight,o))});async function p(){try{if(r){let e=w.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");e=e.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),e.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await r.loadPackagesFromImports(e);var t=await r.runPythonAsync(e);t&&v.update(E=>E+=t)}}catch(e){console.log("Error:"+e),v.update(m=>m+="Error:"+e+`
`)}}function c(t){z[t?"unshift":"push"](()=>{o=t,i(0,o)})}return[o,c]}class B extends P{constructor(a){super(),I(this,a,U,M,T,{})}}export{B as default};
