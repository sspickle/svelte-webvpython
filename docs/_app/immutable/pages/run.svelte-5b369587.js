import{S as P,i as I,s as T,e as _,t as S,k as E,c as y,a as g,h as x,d as i,m as b,b as w,g as f,J as k,E as R,v as O,L as j}from"../chunks/index-26a557cf.js";import{w as z,b as C}from"../chunks/paths-e19757bb.js";import{s as D}from"../chunks/codeSrc-adb860ce.js";const v=z(""),H=async r=>{console.log("loading prep");const s=fetch("vpython.zip").then(o=>o.arrayBuffer());let n=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/dev/full/",stdout:r||null,stderr:r||null});const u=await s;return console.log("Unpacking package"),n.unpackArchive(u,"zip"),console.log("Importing vpython package"),n},J=async()=>{let r,s;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},r=window.canvas,s=r(),s};function L(r){let s,n,u,o,h,a,l,p,d,c;return{c(){s=_("a"),n=S("Edit this code"),u=E(),o=_("h2"),h=S("Running...."),a=E(),l=_("div"),p=E(),d=_("div"),c=_("textarea"),this.h()},l(t){s=y(t,"A",{href:!0,target:!0});var e=g(s);n=x(e,"Edit this code"),e.forEach(i),u=b(t),o=y(t,"H2",{});var m=g(o);h=x(m,"Running...."),m.forEach(i),a=b(t),l=y(t,"DIV",{id:!0,class:!0}),g(l).forEach(i),p=b(t),d=y(t,"DIV",{});var A=g(d);c=y(A,"TEXTAREA",{rows:!0,cols:!0}),g(c).forEach(i),A.forEach(i),this.h()},h(){w(s,"href",C+"/"),w(s,"target","_self"),w(l,"id","glowscript"),w(l,"class","glowscript"),w(c,"rows","10"),w(c,"cols","80"),c.hidden=!0},m(t,e){f(t,s,e),k(s,n),f(t,u,e),f(t,o,e),k(o,h),f(t,a,e),f(t,l,e),f(t,p,e),f(t,d,e),k(d,c),r[1](c)},p:R,i:R,o:R,d(t){t&&i(s),t&&i(u),t&&i(o),t&&i(a),t&&i(l),t&&i(p),t&&i(d),r[1](null)}}}function M(r,s,n){function u(t){p&&v.update(e=>e+=t+`
`)}let o=null,h,a,l,p=!1;O(async()=>(l=await J(),o=await H(u),window.scene=l,window.__reportScriptError=t=>{u("REPORT ERROR:"+JSON.stringify(t))},v.set(""),p=!0,d(),()=>{p=!1})),D.subscribe(t=>{h=t}),v.subscribe(t=>{a&&(t.length>0&&(console.log("in stdout update:",t),a.removeAttribute("hidden")),n(0,a.value=t,a),n(0,a.scrollTop=a.scrollHeight,a))});async function d(){try{if(o){let e=h.split("rate(").join("await async_rate(");await o.loadPackagesFromImports(e);var t=await o.runPythonAsync(e);t&&v.update(m=>m+=t)}}catch(e){console.log("Error:"+e),v.update(m=>m+="Error:"+e+`
`)}}function c(t){j[t?"unshift":"push"](()=>{a=t,n(0,a)})}return[a,c]}class B extends P{constructor(s){super(),I(this,s,M,L,T,{})}}export{B as default};
