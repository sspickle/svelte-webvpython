import{S as J,i as L,s as M,e as _,t as C,k,c as v,a as b,h as T,d,m as x,b as y,g as h,J as A,E as P,L as R,v as U,M as z}from"../chunks/index-f57992c5.js";import{w as F,b as H}from"../chunks/paths-3a77cd68.js";import{s as N,p as V}from"../chunks/prefs-79816110.js";const g=F(""),j=async(l,r,u)=>{console.log("loading prep");const m=fetch("vpython.zip").then(a=>a.arrayBuffer());console.log(r,l);let s;try{s=await loadPyodide({indexURL:u,stdout:l||null,stderr:r||null})}catch(a){throw console.log(a),a}if(s){const a=await m;console.log("Unpacking package"),s.unpackArchive(a,"zip"),console.log("Importing vpython package")}return s},q=async()=>{let l,r;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},l=window.canvas,r=l(),r};function B(l){let r,u,m,s,a,c,f,o,w,n;return{c(){r=_("a"),u=C("Edit this code"),m=k(),s=_("h2"),a=C("Running...."),c=k(),f=_("div"),o=k(),w=_("div"),n=_("textarea"),this.h()},l(t){r=v(t,"A",{href:!0,target:!0});var i=b(r);u=T(i,"Edit this code"),i.forEach(d),m=x(t),s=v(t,"H2",{});var E=b(s);a=T(E,"Running...."),E.forEach(d),c=x(t),f=v(t,"DIV",{id:!0,class:!0}),b(f).forEach(d),o=x(t),w=v(t,"DIV",{});var S=b(w);n=v(S,"TEXTAREA",{rows:!0,cols:!0}),b(n).forEach(d),S.forEach(d),this.h()},h(){y(r,"href",H+"/"),y(r,"target","_self"),y(f,"id","glowscript"),y(f,"class","glowscript"),y(n,"rows","10"),y(n,"cols","80"),n.hidden=!0},m(t,i){h(t,r,i),A(r,u),h(t,m,i),h(t,s,i),A(s,a),h(t,c,i),h(t,f,i),h(t,o,i),h(t,w,i),A(w,n),l[1](n)},p:P,i:P,o:P,d(t){t&&d(r),t&&d(m),t&&d(s),t&&d(c),t&&d(f),t&&d(o),t&&d(w),l[1](null)}}}let G="https://cdn.jsdelivr.net/pyodide/v0.21.0a3/full/";function X(l,r,u){let m;R(l,V,e=>u(6,m=e));function s(e){n&&g.update(p=>p+=e+`
`)}function a(e){n&&g.update(p=>p+="stderr:"+e+`
`)}let c=null,f,o,w,n=!1,t=m.add_default_imports,i=`from math import *
from numpy import arange
from random import random
from vpython import *
`;U(async()=>{try{w=await q(),c=await j(s,a,G)}catch(e){a(JSON.stringify(e))}if(c)return window.scene=w,window.__reportScriptError=e=>{a("__reportScriptError:"+JSON.stringify(e));debugger},g.set(""),n=!0,E(),()=>{n=!1};a("Pyodide not found")}),N.subscribe(e=>{f=e}),g.subscribe(e=>{o&&(e.length>0&&o.hasAttribute("hidden")&&o.removeAttribute("hidden"),u(0,o.value=e,o),u(0,o.scrollTop=o.scrollHeight,o))});async function E(){try{if(c){let p=f.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");if(p=p.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),t){await c.loadPackagesFromImports(i);var e=await c.runPythonAsync(i)}p.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await c.loadPackagesFromImports(p);var e=await c.runPythonAsync(p);e&&g.update(D=>D+=e)}}catch(p){console.log("Error:"+p),g.update(I=>I+="Error:"+p+`
`)}}function S(e){z[e?"unshift":"push"](()=>{o=e,u(0,o)})}return[o,S]}class W extends J{constructor(r){super(),L(this,r,X,B,M,{})}}export{W as default};
