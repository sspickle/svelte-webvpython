import{S as J,i as L,s as M,e as _,t as C,k,c as v,a as b,h as T,d,m as x,b as y,g as w,J as A,E as P,L as N,v as R,M as U}from"../chunks/index-f57992c5.js";import{w as z,b as F}from"../chunks/paths-3a77cd68.js";import{s as H,p as V}from"../chunks/prefs-79816110.js";const g=z(""),j=async(c,r,u)=>{console.log("loading prep");const m=fetch("vpython.zip").then(o=>o.arrayBuffer());console.log(r,c);let s;try{s=await loadPyodide({indexURL:u,stdout:c||null,stderr:r||null})}catch(o){throw console.log(o),o}if(s){const o=await m;console.log("Unpacking package"),s.unpackArchive(o,"zip"),console.log("Importing vpython package")}return s},q=async()=>{let c,r;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},c=window.canvas,r=c(),r};function B(c){let r,u,m,s,o,p,f,a,h,n;return{c(){r=_("a"),u=C("Edit this code"),m=k(),s=_("h2"),o=C("Running...."),p=k(),f=_("div"),a=k(),h=_("div"),n=_("textarea"),this.h()},l(t){r=v(t,"A",{href:!0,target:!0});var i=b(r);u=T(i,"Edit this code"),i.forEach(d),m=x(t),s=v(t,"H2",{});var E=b(s);o=T(E,"Running...."),E.forEach(d),p=x(t),f=v(t,"DIV",{id:!0,class:!0}),b(f).forEach(d),a=x(t),h=v(t,"DIV",{});var S=b(h);n=v(S,"TEXTAREA",{rows:!0,cols:!0}),b(n).forEach(d),S.forEach(d),this.h()},h(){y(r,"href",F+"/"),y(r,"target","_self"),y(f,"id","glowscript"),y(f,"class","glowscript"),y(n,"rows","10"),y(n,"cols","80"),n.hidden=!0},m(t,i){w(t,r,i),A(r,u),w(t,m,i),w(t,s,i),A(s,o),w(t,p,i),w(t,f,i),w(t,a,i),w(t,h,i),A(h,n),c[1](n)},p:P,i:P,o:P,d(t){t&&d(r),t&&d(m),t&&d(s),t&&d(p),t&&d(f),t&&d(a),t&&d(h),c[1](null)}}}let G="https://cdn.jsdelivr.net/pyodide/v0.21.0a3/full/";function X(c,r,u){let m;N(c,V,e=>u(6,m=e));function s(e){n&&g.update(l=>l+=e+`
`)}function o(e){n&&g.update(l=>l+="stderr:"+e+`
`)}let p=null,f,a,h,n=!1,t=m.add_default_imports,i=`from math import *
from numpy import arange
from random import random
from vpython import *
`;R(async()=>{try{h=await q(),p=await j(s,o,G)}catch(e){o(JSON.stringify(e))}if(p)return window.scene=h,window.__reportScriptError=e=>{try{o("__reportScriptError:"+JSON.stringify(e))}catch{o("__reportScriptError: Not sure! Cannot stringify")}debugger},g.set(""),n=!0,E(),()=>{n=!1};o("Pyodide not found")}),H.subscribe(e=>{f=e}),g.subscribe(e=>{a&&(e.length>0&&a.hasAttribute("hidden")&&a.removeAttribute("hidden"),u(0,a.value=e,a),u(0,a.scrollTop=a.scrollHeight,a))});async function E(){try{if(p){let l=f.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");if(l=l.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),t){await p.loadPackagesFromImports(i);var e=await p.runPythonAsync(i)}l.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await p.loadPackagesFromImports(l);var e=await p.runPythonAsync(l);e&&g.update(D=>D+=e)}}catch(l){console.log("Error:"+l),g.update(I=>I+="Error:"+l+`
`)}}function S(e){U[e?"unshift":"push"](()=>{a=e,u(0,a)})}return[a,S]}class W extends J{constructor(r){super(),L(this,r,X,B,M,{})}}export{W as default};
