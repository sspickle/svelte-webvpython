import{S as J,i as L,s as M,e as _,t as C,k as x,c as v,a as b,h as T,d,m as S,b as y,g as h,J as A,E as P,L as R,v as U,M as z}from"../chunks/index-f57992c5.js";import{w as F,b as H}from"../chunks/paths-3a77cd68.js";import{s as N,p as V}from"../chunks/prefs-79816110.js";const g=F(""),j=async(l,o,f)=>{console.log("loading prep");const m=fetch("vpython.zip").then(a=>a.arrayBuffer());console.log(o,l);let s;try{s=await loadPyodide({indexURL:f,stdout:l||null,stderr:o||null})}catch(a){throw console.log(a),a}if(s){const a=await m;console.log("Unpacking package"),s.unpackArchive(a,"zip"),console.log("Importing vpython package")}return s},q=async()=>{let l,o;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},l=window.canvas,o=l(),o};function B(l){let o,f,m,s,a,c,u,r,w,n;return{c(){o=_("a"),f=C("Edit this code"),m=x(),s=_("h2"),a=C("Running...."),c=x(),u=_("div"),r=x(),w=_("div"),n=_("textarea"),this.h()},l(t){o=v(t,"A",{href:!0,target:!0});var i=b(o);f=T(i,"Edit this code"),i.forEach(d),m=S(t),s=v(t,"H2",{});var E=b(s);a=T(E,"Running...."),E.forEach(d),c=S(t),u=v(t,"DIV",{id:!0,class:!0}),b(u).forEach(d),r=S(t),w=v(t,"DIV",{});var k=b(w);n=v(k,"TEXTAREA",{rows:!0,cols:!0}),b(n).forEach(d),k.forEach(d),this.h()},h(){y(o,"href",H+"/"),y(o,"target","_self"),y(u,"id","glowscript"),y(u,"class","glowscript"),y(n,"rows","10"),y(n,"cols","80"),n.hidden=!0},m(t,i){h(t,o,i),A(o,f),h(t,m,i),h(t,s,i),A(s,a),h(t,c,i),h(t,u,i),h(t,r,i),h(t,w,i),A(w,n),l[1](n)},p:P,i:P,o:P,d(t){t&&d(o),t&&d(m),t&&d(s),t&&d(c),t&&d(u),t&&d(r),t&&d(w),l[1](null)}}}let G="https://cdn.jsdelivr.net/pyodide/v0.21.0a3/full/";function X(l,o,f){let m;R(l,V,e=>f(6,m=e));function s(e){n&&g.update(p=>p+=e+`
`)}function a(e){n&&g.update(p=>p+="stderr:"+e+`
`)}let c=null,u,r,w,n=!1,t=m.add_default_imports,i=`from math import *
from numpy import arange
from random import random
from vpython import *
`;U(async()=>{try{w=await q(),c=await j(s,a,G)}catch(e){a(JSON.stringify(e))}if(c)return window.scene=w,window.__reportScriptError=e=>{a(JSON.stringify(e))},g.set(""),n=!0,E(),()=>{n=!1};a("Pyodide not found")}),N.subscribe(e=>{u=e}),g.subscribe(e=>{r&&(e.length>0&&r.hasAttribute("hidden")&&r.removeAttribute("hidden"),f(0,r.value=e,r),f(0,r.scrollTop=r.scrollHeight,r))});async function E(){try{if(c){let p=u.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");if(p=p.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),t){await c.loadPackagesFromImports(i);var e=await c.runPythonAsync(i)}p.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await c.loadPackagesFromImports(p);var e=await c.runPythonAsync(p);e&&g.update(D=>D+=e)}}catch(p){console.log("Error:"+p),g.update(I=>I+="Error:"+p+`
`)}}function k(e){z[e?"unshift":"push"](()=>{r=e,f(0,r)})}return[r,k]}class W extends J{constructor(o){super(),L(this,o,X,B,M,{})}}export{W as default};
