import{S as C,i as D,s as M,e as _,t as I,k,c as y,a as v,h as P,d as i,m as x,b as g,g as h,J as S,E as R,L as O,v as z,M as H}from"../chunks/index-f57992c5.js";import{w as J,b as L}from"../chunks/paths-3a77cd68.js";import{s as U,p as V}from"../chunks/prefs-79816110.js";const E=J(""),j=async a=>{console.log("loading prep");const r=fetch("vpython.zip").then(c=>c.arrayBuffer());let l=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/dev/full/",stdout:a||null,stderr:a||null});const d=await r;return console.log("Unpacking package"),l.unpackArchive(d,"zip"),console.log("Importing vpython package"),l},q=async()=>{let a,r;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},a=window.canvas,r=a(),r};function B(a){let r,l,d,c,f,m,o,w,p,u;return{c(){r=_("a"),l=I("Edit this code"),d=k(),c=_("h2"),f=I("Running...."),m=k(),o=_("div"),w=k(),p=_("div"),u=_("textarea"),this.h()},l(t){r=y(t,"A",{href:!0,target:!0});var n=v(r);l=P(n,"Edit this code"),n.forEach(i),d=x(t),c=y(t,"H2",{});var b=v(c);f=P(b,"Running...."),b.forEach(i),m=x(t),o=y(t,"DIV",{id:!0,class:!0}),v(o).forEach(i),w=x(t),p=y(t,"DIV",{});var e=v(p);u=y(e,"TEXTAREA",{rows:!0,cols:!0}),v(u).forEach(i),e.forEach(i),this.h()},h(){g(r,"href",L+"/"),g(r,"target","_self"),g(o,"id","glowscript"),g(o,"class","glowscript"),g(u,"rows","10"),g(u,"cols","80"),u.hidden=!0},m(t,n){h(t,r,n),S(r,l),h(t,d,n),h(t,c,n),S(c,f),h(t,m,n),h(t,o,n),h(t,w,n),h(t,p,n),S(p,u),a[1](u)},p:R,i:R,o:R,d(t){t&&i(r),t&&i(d),t&&i(c),t&&i(m),t&&i(o),t&&i(w),t&&i(p),a[1](null)}}}function F(a,r,l){let d;O(a,V,e=>l(6,d=e));function c(e){p&&E.update(s=>s+=e+`
`)}let f=null,m,o,w,p=!1,u=d.add_default_imports,t=`from math import *
from numpy import arange
from random import random
from vpython import *
`;z(async()=>(w=await q(),f=await j(c),window.scene=w,window.__reportScriptError=e=>{c("REPORT ERROR:"+JSON.stringify(e))},E.set(""),p=!0,n(),()=>{p=!1})),U.subscribe(e=>{m=e}),E.subscribe(e=>{o&&(e.length>0&&(console.log("in stdout update:",e),o.removeAttribute("hidden")),l(0,o.value=e,o),l(0,o.scrollTop=o.scrollHeight,o))});async function n(){try{if(f){let s=m.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");s=s.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),u&&(s=t+`
`+s),console.log(s),s.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await f.loadPackagesFromImports(s);var e=await f.runPythonAsync(s);e&&E.update(T=>T+=e)}}catch(s){console.log("Error:"+s),E.update(A=>A+="Error:"+s+`
`)}}function b(e){H[e?"unshift":"push"](()=>{o=e,l(0,o)})}return[o,b]}class K extends C{constructor(r){super(),D(this,r,F,B,M,{})}}export{K as default};
