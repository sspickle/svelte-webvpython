import{S as C,i as D,s as M,e as g,t as R,k,c as _,a as v,h as I,d as n,m as x,b as y,g as h,J as S,E as A,L as O,v as z,M as F}from"../chunks/index-f57992c5.js";import{w as H,b as J}from"../chunks/paths-3a77cd68.js";import{s as L,p as U}from"../chunks/prefs-79816110.js";const E=H(""),V=async a=>{console.log("loading prep");const r=fetch("vpython.zip").then(l=>l.arrayBuffer());let i=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/dev/full/",stdout:a||null,stderr:a||null});const f=await r;return console.log("Unpacking package"),i.unpackArchive(f,"zip"),console.log("Importing vpython package"),i},j=async()=>{let a,r;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},a=window.canvas,r=a(),r};function q(a){let r,i,f,l,c,m,o,w,p,u;return{c(){r=g("a"),i=R("Edit this code"),f=k(),l=g("h2"),c=R("Running...."),m=k(),o=g("div"),w=k(),p=g("div"),u=g("textarea"),this.h()},l(t){r=_(t,"A",{href:!0,target:!0});var s=v(r);i=I(s,"Edit this code"),s.forEach(n),f=x(t),l=_(t,"H2",{});var b=v(l);c=I(b,"Running...."),b.forEach(n),m=x(t),o=_(t,"DIV",{id:!0,class:!0}),v(o).forEach(n),w=x(t),p=_(t,"DIV",{});var e=v(p);u=_(e,"TEXTAREA",{rows:!0,cols:!0}),v(u).forEach(n),e.forEach(n),this.h()},h(){y(r,"href",J+"/"),y(r,"target","_self"),y(o,"id","glowscript"),y(o,"class","glowscript"),y(u,"rows","10"),y(u,"cols","80"),u.hidden=!0},m(t,s){h(t,r,s),S(r,i),h(t,f,s),h(t,l,s),S(l,c),h(t,m,s),h(t,o,s),h(t,w,s),h(t,p,s),S(p,u),a[1](u)},p:A,i:A,o:A,d(t){t&&n(r),t&&n(f),t&&n(l),t&&n(m),t&&n(o),t&&n(w),t&&n(p),a[1](null)}}}function B(a,r,i){let f;O(a,U,e=>i(6,f=e));function l(e){p&&E.update(d=>d+=e+`
`)}let c=null,m,o,w,p=!1,u=f.add_default_imports,t=`from math import *
from numpy import arange
from random import random
from vpython import *
`;z(async()=>(w=await j(),c=await V(l),window.scene=w,window.__reportScriptError=e=>{l("REPORT ERROR:"+JSON.stringify(e))},E.set(""),p=!0,s(),()=>{p=!1})),L.subscribe(e=>{m=e}),E.subscribe(e=>{o&&(e.length>0&&(console.log("in stdout update:",e),o.removeAttribute("hidden")),i(0,o.value=e,o),i(0,o.scrollTop=o.scrollHeight,o))});async function s(){try{if(c){let d=m.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");if(d=d.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),u){await c.loadPackagesFromImports(t);var e=await c.runPythonAsync(t)}d.match(/[^\.\w]text[\ ]*\(/)&&(window.fontloading(),await window.waitforfonts()),await c.loadPackagesFromImports(d);var e=await c.runPythonAsync(d);e&&E.update(T=>T+=e)}}catch(d){console.log("Error:"+d),E.update(P=>P+="Error:"+d+`
`)}}function b(e){F[e?"unshift":"push"](()=>{o=e,i(0,o)})}return[o,b]}class K extends C{constructor(r){super(),D(this,r,B,q,M,{})}}export{K as default};
