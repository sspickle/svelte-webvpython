import{S as P,i as I,s as T,e as g,t as A,k as E,c as _,a as y,h as S,d as n,m as b,b as m,g as f,J as k,E as x,v as O,L as z}from"../chunks/index-26a557cf.js";import{w as C,b as D}from"../chunks/paths-e19757bb.js";import{s as H}from"../chunks/codeSrc-adb860ce.js";const v=C(""),J=async o=>{console.log("loading prep");const a=fetch("vpython.zip").then(s=>s.arrayBuffer());let i=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/dev/full/",stdout:o||null,stderr:o||null});const p=await a;return console.log("Unpacking package"),i.unpackArchive(p,"zip"),console.log("Importing vpython package"),i},L=async()=>{let o,a;return window.__context={glowscript_container:$("#glowscript").removeAttr("id")},o=window.canvas,a=o(),a};function M(o){let a,i,p,s,w,r,l,u,d,c;return{c(){a=g("a"),i=A("Edit this code"),p=E(),s=g("h2"),w=A("Running...."),r=E(),l=g("div"),u=E(),d=g("div"),c=g("textarea"),this.h()},l(t){a=_(t,"A",{href:!0,target:!0});var e=y(a);i=S(e,"Edit this code"),e.forEach(n),p=b(t),s=_(t,"H2",{});var h=y(s);w=S(h,"Running...."),h.forEach(n),r=b(t),l=_(t,"DIV",{id:!0,class:!0}),y(l).forEach(n),u=b(t),d=_(t,"DIV",{});var R=y(d);c=_(R,"TEXTAREA",{rows:!0,cols:!0}),y(c).forEach(n),R.forEach(n),this.h()},h(){m(a,"href",D+"/"),m(a,"target","_self"),m(l,"id","glowscript"),m(l,"class","glowscript"),m(c,"rows","10"),m(c,"cols","80"),c.hidden=!0},m(t,e){f(t,a,e),k(a,i),f(t,p,e),f(t,s,e),k(s,w),f(t,r,e),f(t,l,e),f(t,u,e),f(t,d,e),k(d,c),o[1](c)},p:x,i:x,o:x,d(t){t&&n(a),t&&n(p),t&&n(s),t&&n(r),t&&n(l),t&&n(u),t&&n(d),o[1](null)}}}function U(o,a,i){function p(t){u&&v.update(e=>e+=t+`
`)}let s=null,w,r,l,u=!1;O(async()=>(l=await L(),s=await J(p),window.scene=l,window.__reportScriptError=t=>{p("REPORT ERROR:"+JSON.stringify(t))},v.set(""),u=!0,d(),()=>{u=!1})),H.subscribe(t=>{w=t}),v.subscribe(t=>{r&&(t.length>0&&(console.log("in stdout update:",t),r.removeAttribute("hidden")),i(0,r.value=t,r),i(0,r.scrollTop=r.scrollHeight,r))});async function d(){try{if(s){let e=w.replace(/[^\.\w\n]rate[\ ]*\(/g," await rate(");e=e.replace(/\n]rate[\ ]*\(/g,`
 await rate(`),e=e.replace(/[^\.\w]text[\ ]*\(/g,"await text("),await s.loadPackagesFromImports(e);var t=await s.runPythonAsync(e);t&&v.update(h=>h+=t)}}catch(e){console.log("Error:"+e),v.update(h=>h+="Error:"+e+`
`)}}function c(t){z[t?"unshift":"push"](()=>{r=t,i(0,r)})}return[r,c]}class B extends P{constructor(a){super(),I(this,a,U,M,T,{})}}export{B as default};
